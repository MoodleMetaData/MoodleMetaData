YUI.add("moodle-block_eclass_course_management-module",function(e,t){M.blocks_eclasscoursemanagement=M.blocks_eclasscoursemanagement||{},M.blocks_eclasscoursemanagement.init=function(){var t=e.one("#configure_form"),n=!1;t.one(".btn-cancel").on("click",function(e){n=!0}),e.on("submit",function(e){if(n===!1){e.preventDefault();var r=M.blocks_eclasscoursemanagement.date_select_to_component("start",t),i=M.blocks_eclasscoursemanagement.date_select_to_component("end",t);M.blocks_eclasscoursemanagement.validate_dates(r,i)}},t)},M.blocks_eclasscoursemanagement.validate_dates=function(e,t){var n=new Date(e.year,e.month,e.day,0,0,0),r=new Date(t.year,t.month,t.day,0,0,0),i=new Date;if(n.getTime()>=r.getTime()&&!s)return(new M.core.alert({message:"Error: Start date must be before end date.",modal:"true",visible:!1})).show(),!1;var s=M.blocks_eclasscoursemanagement.is_course_open(),o=!s&&n.getTime()<=i.getTime()&&r.getTime()>=i.getTime(),u=s&&r.getTime()<=i.getTime();o?M.blocks_eclasscoursemanagement.validate_dates_helper.open_course_case(function(){M.blocks_eclasscoursemanagement.validate_dates_helper.open_later_scenario(i,n,r)}):u?M.blocks_eclasscoursemanagement.validate_dates_helper.close_course_case(function(){M.blocks_eclasscoursemanagement.validate_dates_helper.open_later_scenario(i,n,r)}):M.blocks_eclasscoursemanagement.validate_dates_helper.open_later_scenario(i,n,r)},M.blocks_eclasscoursemanagement.validate_dates_helper=M.blocks_eclasscoursemanagement.validate_dates_helper||{},M.blocks_eclasscoursemanagement.validate_dates_helper.open_course_case=function(e,t){var n=new M.core.confirm({question:"By selecting a start date that has already passed your course will be automatically opened.",modal:"true",visible:!1});n.on("complete-yes",function(){e&&e()}),n.on("complete-no",function(){t&&t()}),n.show()},M.blocks_eclasscoursemanagement.validate_dates_helper.close_course_case=function(e,t){var n=new M.core.confirm({question:"By selecting an end date that has already passed your course will be automatically closed.",modal:"true",visible:!1});n.on("complete-yes",function(){e&&e(),M.blocks_eclasscoursemanagement.validate_dates_helper.open_later_scenario(today_date,start_date,end_date)}),n.on("complete-no",function(){t&&t()}),n.show()},M.blocks_eclasscoursemanagement.validate_dates_helper.open_later_scenario=function(t,n,r){var i=M.blocks_eclasscoursemanagement.is_course_open(),s=!i&&n.getTime()>t.getTime(),o=i&&n.getTime()>t.getTime();if(s){var u=new M.core.confirm({question:"By selecting a start date that is in the future your course will open on the selected date.",modal:"true",visible:!1});u.on("complete-yes",function(){e.one("#configure_form").getDOMNode().submit()}),u.on("complete-no",function(){}),u.show()}else if(o){var u=new M.core.confirm({question:"By selecting a start date that is in the future your course will be automatically closed. Course will open on the selected date.",modal:"true",visible:!1});u.on("complete-yes",function(){e.one("#configure_form").getDOMNode().submit()}),u.on("complete-no",function(){}),u.show()}else e.one("#configure_form").getDOMNode().submit()},M.blocks_eclasscoursemanagement.date_select_to_component=function(e,t){var n=t.one('[name="'+e+'[year]"]').get("value"),r=t.one('[name="'+e+'[month]"]').get("value"),i=t.one('[name="'+e+'[day]"]').get("value"),s=[];return s.year=n,s.month=r-1,s.day=i,s},M.blocks_eclasscoursemanagement.is_course_open=function(){var t=e.one("#configure_form"),n=t.one("#id_visibility option").getHTML();return n.toLowerCase()=="Open".toLowerCase()}},"@VERSION@",{requires:["base","node","event","event-key","io","moodle-core-notification-confirm","moodle-core-notification-alert"]});
