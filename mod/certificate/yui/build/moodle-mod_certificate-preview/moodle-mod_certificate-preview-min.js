YUI.add("moodle-mod_certificate-preview",function(e,t){function n(e){void e,n.superclass.constructor.apply(this,arguments)}function r(e){void e,r.superclass.constructor.apply(this,arguments)}e.namespace("M.mod_certificate").utility={aspect_ratio:{a4_aspect_ratio:1.414,letter_aspect_ratio:Math.sqrt(2)},orientation:{landscape:0,portrait:1}},Object.freeze(e.namespace("M.mod_certificate").utility.aspect_ratio),Object.freeze(e.namespace("M.mod_certificate").utility.orientation),e.namespace("M.mod_certificate").iframe_wrapper=n,e.extend(e.namespace("M.mod_certificate").iframe_wrapper,e.Base,{initializer:function(e){this.iframe_node=e.iframe_node,this.aspect_ratio=e.aspect_ratio,this.orientation=e.orientation,this.setup_events()},setup_events:function(){var t=e.one("#preview-iframe"),n=this;t.on("load",function(){n.fire("load")}),t.on("windowresize",function(e){n.fire("resize",e)})},get_new_width:function(){if(this.orientation===e.namespace("M.mod_certificate").utility.orientation.landscape)return parseInt(this.iframe_node.getComputedStyle("height"),10)*this.aspect_ratio;if(this.orientation===e.namespace("M.mod_certificate").utility.orientation.portrait)return parseInt(this.iframe_node.getComputedStyle("height"),10)/this.aspect_ratio;console.error("orientation attribute is invalid.")},get_new_height:function(){if(this.orientation===e.namespace("M.mod_certificate").utility.orientation.landscape)return parseInt(this.iframe_node.getComputedStyle("width"),10)/this.aspect_ratio;if(this.orientation===e.namespace("M.mod_certificate").utility.orientation.portrait)return parseInt(this.iframe_node.getComputedStyle("width"),10)*this.aspect_ratio;console.error("orientation attribute is invalid.")},set_width:function(e){this.iframe_node.set("width",e+"px"),this.iframe_node.setStyle("width",e+"px")},set_height:function(e){this.iframe_node.set("height",e+"px"),this.iframe_node.setStyle("height",e+"px")},update_iframe_size:function(e,t){if(typeof t!="undefined"&&t!==null)if(e==="width")this.set_width(t);else{if(e!=="height"){console.error("base_side argument is invalid.");return}this.set_height(t)}if(e==="width"){var n=this.get_new_height();this.set_height(n)}else if(e==="height"){var r=this.get_new_width();this.set_width(r)}else console.error("base_side argument is invalid.")}},{NAME:"iframe_wrapper",ATTRS:{}}),e.namespace("M.mod_certificate").form_wrapper=r,e.extend(e.namespace("M.mod_certificate").form_wrapper,e.Base,{initializer:function(e){this.preview_link=e.preview_link,this.course_module_id=e.course_module_id,this.setup_events()},setup_events:function(){var t=this;e.all("form *").each(function(e){e.on("change",function(e){t.fire("field-change"),e.stopPropagation()})})},toggle_preview_section:function(){e.one("#id_previewsection").removeClass("collapsed")},get_field_value:function(t){return e.one('[name="'+t+'"]').get("value")},get_aspect_ratio:function(){var t=/.*a4.*/i,n=/.*letter.*/i,r=this.get_field_value("certificatetype");if(r.search(t))return e.namespace("M.mod_certificate").utility.aspect_ratio.a4_aspect_ratio;if(r.search(n))return e.namespace("M.mod_certificate").utility.aspect_ratio.letter_aspect_ratio;console.error("Recent changes on certificatetype must've occured. Change Y.namespace('M.mod_certificate').get_aspect_ratio function accordingly")},render_preview:function(){var t=e.one("#preview-iframe"),n=this.get_field_value,r=this.preview_link+"?"+"id="+this.course_module_id+"&"+"name="+n("name")+"&"+"orientation="+n("orientation")+"&"+"bordercolor="+n("bordercolor")+"&"+"borderstyle="+n("borderstyle")+"&"+"printseal="+n("printseal")+"&"+"printsignature="+n("printsignature")+"&"+"printwmark="+n("printwmark")+"&"+"printdate="+n("printdate")+"&"+"printteacher="+n("printteacher")+"&"+"datefmt="+n("datefmt")+"&"+"printgrade="+n("printgrade")+"&"+"gradefmt="+n("gradefmt")+"&"+"printoutcome="+n("printoutcome")+"&"+"printhours="+n("printhours")+"&"+"printnumber="+n("printnumber")+"&"+"certificatetype="+n("certificatetype")+"&"+"customtext="+n("customtext");t.set("src",r)}},{NAME:"form_wrapper",ATTRS:{}}),e.namespace("M.mod_certificate").init=function(t,n){var r=new e.M.mod_certificate.form_wrapper({preview_link:t,course_module_id:n});r.toggle_preview_section(),r.render_preview();var i=e.one("#preview-iframe"),s=new e.M.mod_certificate.iframe_wrapper({iframe_node:i,aspect_ratio:e.namespace("M.mod_certificate").utility.aspect_ratio.a4_aspect_ratio,orientation:e.namespace("M.mod_certificate").utility.orientation.landscape}),o=function(){s.aspect_ratio=r.get_aspect_ratio();var t=r.get_field_value("orientation")==="P",n=r.get_field_value("orientation")==="L";t?s.orientation=e.namespace("M.mod_certificate").utility.orientation.portrait:n?s.orientation=e.namespace("M.mod_certificate").utility.orientation.landscape:console.error("Orientation not recognized."),s.update_iframe_size("width"),r.render_preview()};r.on("field-change",function(){o()}),s.once("load",function(){o()}),s.on("resize",function(){s.update_iframe_size("width")})}},"@VERSION@",{requires:["base","node","event","event-key","io"]});
