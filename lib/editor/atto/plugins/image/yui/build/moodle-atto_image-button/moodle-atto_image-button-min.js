YUI.add("moodle-atto_image-button",function(e,t){e.namespace("M").atto_image={parseInt10:function(e){return parseInt(e,10)},get_natural_image_size:function(e){var t=new Image;return t.src=e,{width:t.width,height:t.height}},get_natural_image_aspect_ratio:function(t){return t.width*e.M.atto_image.get("image_size_multiplier")/(t.height*e.M.atto_image.get("image_size_multiplier"))},set_node_pos:function(e,t){t?(t.top!==null&&typeof t.top!="undefined"&&e.setStyle("top",t.top),t.right!==null&&typeof t.right!="undefined"&&e.setStyle("right",t.right),t.bottom!==null&&typeof t.bottom!="undefined"&&e.setStyle("bottom",t.bottom),t.left!==null&&typeof t.left!="undefined"&&e.setStyle("left",t.left)):console.error("Given position object is invalid")},get_horizontal_border_width:function(t){return e.M.atto_image.parseInt10(t.getComputedStyle("border-left-width"))+e.M.atto_image.parseInt10(t.getComputedStyle("border-right-width"))},get_vertical_border_width:function(t){return e.M.atto_image.parseInt10(t.getComputedStyle("border-top-width"))+e.M.atto_image.parseInt10(t.getComputedStyle("border-bottom-width"))},get_horizontal_padding_width:function(t){return e.M.atto_image.parseInt10(t.getComputedStyle("padding-left"))+e.M.atto_image.parseInt10(t.getComputedStyle("padding-right"))},get_vertical_padding_width:function(t){return e.M.atto_image.parseInt10(t.getComputedStyle("padding-bottom"))+e.M.atto_image.parseInt10(t.getComputedStyle("padding-top"))},get_horizontal_non_content_width:function(e){return this.get_horizontal_border_width(e)+this.get_horizontal_padding_width(e)},get_vertical_non_content_width:function(e){return this.get_vertical_border_width(e)+this.get_vertical_padding_width(e)},nesw_to_trbl:function(t){return t.map(function(t){return e.M.atto_image.get("nesw_to_trbl_map")[t]})},enable_hide_until_save:function(e){e.addClass("Mso-atto-image-resizable-node")},disable_hide_until_save:function(e){e.removeClass("Mso-atto-image-resizable-node")},is_mutation_observer_supported:function(){return typeof MutationObserver!="undefined"}},e.augment(e.namespace("M").atto_image,e.Attribute),e.namespace("M").atto_image._attr={image_size_multiplier:{value:100,readOnly:!0},maximum_pixel_size:{value:1e6,readOnly:!0},default_handle_config:{valueFn:function(){return["nw","ne","sw","se","n","s","e","w"]},getter:function(){return["nw","ne","sw","se","n","s","e","w"]},readOnly:!0},default_min_width:{value:100,readOnly:!0},default_min_height:{value:100,readOnly:!0},default_max_width:{valueFn:function(){return this.get("maximum_pixel_size")},readOnly:!0},default_max_height:{valueFn:function(){return this.get("maximum_pixel_size")},readOnly:!0},default_resize_cfg:{valueFn:function(){return{disabled:!1,handle_config:this.get("default_handle_config"),min_width:this.get("default_min_width"),min_height:this.get("default_min_height"),max_width:this.get("default_max_width"),max_height:this.get("default_max_height")}},readOnly:!0},option_overlay_node_wrapper_template:{value:'<div class="atto-image-overlay atto-image-overlay-node-wrapper atto_control {{classes}}"></div>',readOnly:!0},option_overlay_node_template:{value:'<div class="atto-image-overlay atto_control {{classes}}"></div>',readOnly:!0},resize_overlay_node_template:{value:'<div class="atto-image-resize-overlay atto_control {{classes}}"></div>',readOnly:!0},resize_node_container:{value:'<div class="atto-image-resize-container atto_control {{classes}}" ></div>',readOnly:!0},resize_handle_template:{value:'<div class="atto-image-resize-handle atto_control {{class_list}}"></div>',readOnly:!0},float_decorator_button_template:{value:'<button class="atto_control atto_html_button atto-image-float {{class}} atto-image" type="button" title="{{title}}"></button>',readOnly:!0},vertical_align_decorator_button_template:{value:'<button class="atto_control atto_html_button atto-vertical-align-float {{class}} atto-image" type="button" title="{{title}}"></button>',readOnly:!0},border_decorator_button_template:{value:'<button class="atto_control atto_html_button atto_html_button atto-image-border atto-image" type="button" title="{{title}}"></button>',readOnly:!0},border_decorator_panel_template:{value:'<div class="atto_control atto-image-panel atto-image-border-panel atto-image">  <div class="yui3-widget-bd">    <form>      <fieldset>        <div class="atto-image-input atto-image-border-top">          <label for="top">Top:</label><input type="number" min="0" name="top" value="{{border-top}}"/><span>px</span>          <div class="atto-image-illustration"></div>        </div>        <div class="atto-image-input atto-image-border-right">          <label for="right">Right:</label><input type="number" min="0" name="right" value="{{border-right}}"/><span>px</span>          <div class="atto-image-illustration"></div>        </div>        <div class="atto-image-input atto-image-border-bottom">          <label for="bottom">Bottom:</label><input type="number" min="0" name="bottom" value="{{border-bottom}}"/><span>px</span>          <div class="atto-image-illustration"></div>        </div>        <div class="atto-image-input atto-image-border-left">          <label for="left">Left:</label><input type="number" min="0" name="left" value="{{border-left}}"/><span>px</span>          <div class="atto-image-illustration"></div>        </div>      </fieldset>    </form>  </div></div>',readOnly:!0},spacing_decorator_button_template:{value:'<button class="atto_control atto_html_button atto-image-spacing atto-image" type="button" title="{{title}}"></button>',readOnly:!0},spacing_decorator_panel_template:{value:'<div class="atto_control atto-image-panel atto-image-spacing-panel atto-image">  <div class="yui3-widget-bd">    <form>      <fieldset>        <div class="atto-image-input atto-image-spacing-top">          <label for="top">Top:</label><input type="number" name="top" min="0" value="{{margin-top}}"/><span>px</span>          <div class="atto-image-illustration"></div>        </div>        <div class="atto-image-input atto-image-spacing-right">          <label for="right">Right:</label><input type="number" name="right" min="0" value="{{margin-right}}"/><span>px</span>          <div class="atto-image-illustration"></div>        </div>        <div class="atto-image-input atto-image-spacing-bottom">          <label for="bottom">Bottom:</label><input type="number" name="bottom" min="0" value="{{margin-bottom}}"/><span>px</span>          <div class="atto-image-illustration"></div>        </div>        <div class="atto-image-input atto-image-spacing-left">          <label for="left">Left:</label><input type="number" name="left" value="{{margin-left}}"/><span>px</span>          <div class="atto-image-illustration"></div>        </div>      </fieldset>    </form>  </div></div>'
,readOnly:!0},custom_decorator_button_template:{value:'<button class="atto_control atto_html_button atto-image-custom atto-image {{classes}} " type="button" title="{{title}}"></button>',readOnly:!0},custom_decorator_panel_template:{value:'<div class="atto-image-panel atto-image-custom-panel atto-image">  <div class="yui3-widget-bd">    <form>      <fieldset>        <p>          <label for="stylesheet">Custom Stylesheet</label><br/>            <div class="atto-image-contenteditable-container">              <div class="atto-image-contenteditable atto-image-contenteditable-stylesheet" contenteditable="true"><pre>{{custom_styles}}</pre>              </div>            </div>        </p>        {{#if custom_css_class}}        <hr>        <p>          <label for="classes">Custom CSS Classes</label><br/>            <div class="atto-image-contenteditable-container">              <div class="atto-image-contenteditable atto-image-contenteditable-classes" contenteditable="true"><pre>{{custom_classes}}</pre>              </div>        </p>        {{/if}}      </fieldset>    </form>  </div></div>',readOnly:!0},image_forbidden_classes:{value:[/atto_control/g,/Mso-.*/g,/atto-.*/g],readOnly:!0},nesw_to_trbl_map:{valueFn:function(){return{n:"t",e:"r",s:"b",w:"l",ne:"tr",nw:"tl",se:"br",sw:"bl"}},readOnly:!0},easing_classes:{valueFn:function(){return Object.keys(e.Easing)},readOnly:!0}},e.namespace("M").atto_image.addAttrs(e.namespace("M").atto_image._attr,{}),e.namespace("M").atto_image.DEBUG=!0;var n={RESPONSIVE:"img-responsive",INPUTALIGNMENT:"atto_image_alignment",INPUTALT:"atto_image_altentry",INPUTHEIGHT:"atto_image_heightentry",INPUTSUBMIT:"atto_image_urlentrysubmit",INPUTURL:"atto_image_urlentry",INPUTSIZE:"atto_image_size",INPUTWIDTH:"atto_image_widthentry",IMAGEALTWARNING:"atto_image_altwarning",IMAGEBROWSER:"openimagebrowser",IMAGEPRESENTATION:"atto_image_presentation",INPUTCONSTRAIN:"atto_image_constrain",INPUTCUSTOMSTYLE:"atto_image_customstyle",IMAGEPREVIEW:"atto_image_preview",IMAGEPREVIEWBOX:"atto_image_preview_box"},r={INPUTURL:"."+n.INPUTURL},i=[{name:"text-top",str:"alignment_top",value:"vertical-align",margin:"0 .5em"},{name:"middle",str:"alignment_middle",value:"vertical-align",margin:"0 .5em"},{name:"text-bottom",str:"alignment_bottom",value:"vertical-align",margin:"0 .5em",isDefault:!0},{name:"left",str:"alignment_left",value:"float",margin:"0 .5em 0 0"},{name:"right",str:"alignment_right",value:"float",margin:"0 0 0 .5em"},{name:"customstyle",str:"customstyle",value:"style"}],s={ISPERCENT:/\d+%/},o="atto_image",u='<form class="atto_form"><label for="{{elementid}}_{{CSS.INPUTURL}}">{{get_string "enterurl" component}}</label><input class="fullwidth {{CSS.INPUTURL}}" type="url" id="{{elementid}}_{{CSS.INPUTURL}}" size="32"/><br/>{{#if showFilepicker}}<button class="{{CSS.IMAGEBROWSER}}" type="button">{{get_string "browserepositories" component}}</button>{{/if}}<div style="display:none" role="alert" class="warning {{CSS.IMAGEALTWARNING}}">{{get_string "presentationoraltrequired" component}}</div><label for="{{elementid}}_{{CSS.INPUTALT}}">{{get_string "enteralt" component}}</label><input class="fullwidth {{CSS.INPUTALT}}" type="text" value="" id="{{elementid}}_{{CSS.INPUTALT}}" size="32"/><br/><input type="checkbox" class="{{CSS.IMAGEPRESENTATION}}" id="{{elementid}}_{{CSS.IMAGEPRESENTATION}}"/><label class="sameline" for="{{elementid}}_{{CSS.IMAGEPRESENTATION}}">{{get_string "presentation" component}}</label><br/><label class="sameline" for="{{elementid}}_{{CSS.INPUTSIZE}}">{{get_string "size" component}}</label><div id="{{elementid}}_{{CSS.INPUTSIZE}}" class="{{CSS.INPUTSIZE}}"><label class="accesshide" for="{{elementid}}_{{CSS.INPUTWIDTH}}">{{get_string "width" component}}</label><input type="text" class="{{CSS.INPUTWIDTH}} input-mini" id="{{elementid}}_{{CSS.INPUTWIDTH}}" size="4"/> x <label class="accesshide" for="{{elementid}}_{{CSS.INPUTHEIGHT}}">{{get_string "height" component}}</label><input type="text" class="{{CSS.INPUTHEIGHT}} input-mini" id="{{elementid}}_{{CSS.INPUTHEIGHT}}" size="4"/><input type="checkbox" class="{{CSS.INPUTCONSTRAIN}} sameline" id="{{elementid}}_{{CSS.INPUTCONSTRAIN}}"/><label for="{{elementid}}_{{CSS.INPUTCONSTRAIN}}">{{get_string "constrain" component}}</label></div><label class="sameline" for="{{elementid}}_{{CSS.INPUTALIGNMENT}}">{{get_string "alignment" component}}</label><select class="{{CSS.INPUTALIGNMENT}}" id="{{elementid}}_{{CSS.INPUTALIGNMENT}}">{{#each alignments}}<option value="{{value}}:{{name}};">{{get_string str ../component}}</option>{{/each}}</select><input type="hidden" class="{{CSS.INPUTCUSTOMSTYLE}}"/><br/><div class="mdl-align"><div class="{{CSS.IMAGEPREVIEWBOX}}"><img src="#" class="{{CSS.IMAGEPREVIEW}}" alt="" style="display: none;"/></div><button class="{{CSS.INPUTSUBMIT}}" type="submit">{{get_string "saveimage" component}}</button></div></form>',a='<img src="{{url}}" alt="{{alt}}" {{#if width}}width="{{width}}" {{/if}}{{#if height}}height="{{height}}" {{/if}}{{#if presentation}}role="presentation" {{/if}}style="{{alignment}}{{margin}}{{customstyle}}"{{#if classlist}}class="{{classlist}}" {{/if}}/>';e.namespace("M.atto_image").overlay=function(t){void t,e.M.atto_image.overlay.superclass.constructor.apply(this,arguments)},e.extend(e.M.atto_image.overlay,e.Base,{initializer:function(e){this.setAttrs(e),this._setup_overlay_node()},destructor:function(){this.get("decorator").forEach(function(e){e.destroy()},this),this.get("overlay")&&this.get("overlay").destroy(),this.get("overlay_node")&&this.get("overlay_true").remove(!0)},decorate:function(){this.get("decorator").forEach(function(e){e.decorate(this.get("overlay"))},this)},align:function(){this._setup_overlay_node(),this.get("overlay").align()},render:function(){this.get("overlay").render(),this._setup_overlay_node()},_setup_overlay_node:function(){var t=this.get("align_node");if(t===null||typeof t=="undefined"){console.error("Cannot setup overlay node, align_node is not set.");return}
var n=e.WidgetPositionAlign;this.get("overlay_node").addClass("horizontal-align"),this.get("overlay").align(this.get("align_node"),[n.TL,n.BL])}},{NAME:"overlay",ATTRS:{align_node:{value:null,validator:function(t){var n=t===null||t instanceof e.Node;return n||console.error("Given node to encapsulate is not of appropriate type."),n}},overlay_node_wrapper:{value:null,setter:function(e){return e===null?e:(this.get("overlay_node")&&e.appendChild(this.get("overlay_node")),e)},validator:function(t){var n=t===null||t instanceof e.Node;return n||console.error("Given node to encapsulate is not of appropriate type."),n}},overlay_node:{valueFn:function(){var t=e.Handlebars.compile(e.M.atto_image.get("option_overlay_node_template"));return e.Node.create(t({classes:""}))},validator:function(t){var n=t instanceof e.Node;return n||console.error("Given overlay is invalid."),n},readOnly:!0},overlay:{valueFn:function(){var t=e.WidgetPositionAlign;return new e.Overlay({srcNode:this.get("overlay_node"),align:{node:this.get("align_node"),points:[t.BL,t.TL]}})},validator:function(t){var n=t instanceof e.Overlay;return n||console.error("Given overlay is invalid."),n},readOnly:!0},decorator:{value:[],validator:function(e){var t=e instanceof Array;return t||console.error("Given decorator type is not an Array"),t}}}}),e.namespace("M.atto_image").overlay_decorator=function(t){void t,e.M.atto_image.overlay_decorator.superclass.constructor.apply(this,arguments)},e.extend(e.M.atto_image.overlay_decorator,e.Base,{initializer:function(e){this.setAttrs(e)},destructor:function(){this.get("_overlay_components").forEach(function(e){e.remove(!0)})},decorate:function(e){void e}},{NAME:"overlay-decorator",ATTRS:{node:{value:null,validator:function(t){var n=t===null||t instanceof e.Node;return n||console.error("Given node to encapsulate is not of appropriate type."),n}},_overlay_components:{value:[],validator:function(e){var t=e instanceof Array;return t||console.error("Given _overlay_components is of invalid type."),t}}}}),e.namespace("M.atto_image").float_decorator=function(t){void t,e.M.atto_image.float_decorator.superclass.constructor.apply(this,arguments)},e.extend(e.M.atto_image.float_decorator,e.M.atto_image.overlay_decorator,{decorate:function(t){var n=e.M.atto_image.get("float_decorator_button_template"),r=e.Handlebars.compile(n),i=e.Node.create(r({"class":"atto-image-left",title:M.util.get_string("leftaligntooltip",o)})),s=e.Node.create(r({"class":"atto-image-right",title:M.util.get_string("rightaligntooltip",o)})),u=e.Node.create(r({"class":"atto-image-none",title:M.util.get_string("normalflowtooltip",o)})),a=this.get("node").getStyle("float").toLowerCase();switch(a){case"left":this._highlight_button(i);break;case"right":this._highlight_button(s);break;case"initial":this._highlight_button(u)}this.set("_overlay_components",[i,s,u]),i.on("click",function(e){void e,this.get("node").setStyle("float","left"),this._highlight_button(i),t.align()},this),s.on("click",function(e){void e,this.get("node").setStyle("float","right"),this._highlight_button(s),t.align()},this),u.on("click",function(e){void e,this.get("node").setStyle("float","initial"),this._highlight_button(u),t.align()},this),t.get("srcNode").appendChild(i),t.get("srcNode").appendChild(s),t.get("srcNode").appendChild(u),t.align()},_highlight_button:function(e){e.addClass("atto-image-highlight"),this.get("_overlay_components").forEach(function(t){t!==e&&e.removeClass("atto-image-highlight")})},_remove_highlight_on_all_button:function(){this.get("_overlay_components").forEach(function(e){e.removeClass("atto-image-highlight")})}},{NAME:"float-decorator",ATTRS:{}}),e.namespace("M.atto_image").border_decorator=function(t){void t,e.M.atto_image.border_decorator.superclass.constructor.apply(this,arguments)},e.extend(e.M.atto_image.border_decorator,e.M.atto_image.overlay_decorator,{decorate:function(t){var n=e.M.atto_image.get("border_decorator_button_template"),r=e.Handlebars.compile(n),i=e.Node.create(r({title:M.util.get_string("bordertooltip",o)}));i.on("click",function(t){void t;var n={left:this.get("node").getComputedStyle("border-left-width"),top:this.get("node").getComputedStyle("border-top-width"),right:this.get("node").getComputedStyle("border-right-width"),bottom:this.get("node").getComputedStyle("border-bottom-width")},r=e.Handlebars.compile(e.M.atto_image.get("border_decorator_panel_template")),i=e.Node.create(r({"border-top":e.M.atto_image.parseInt10(n.top),"border-right":e.M.atto_image.parseInt10(n.right),"border-bottom":e.M.atto_image.parseInt10(n.bottom),"border-left":e.M.atto_image.parseInt10(n.left)})),s=this,o=new e.Panel({bodyContent:i,headerContent:"border",zIndex:99,centered:!0,modal:!0,render:!0,buttons:[{value:"Ok",section:e.WidgetStdMod.FOOTER,action:function(e){var t=this.get("bodyContent").item(0),n={};t.all("input").each(function(e){switch(e.get("name")){case"left":n["border-left"]=e.get("value")+"px solid black";break;case"top":n["border-top"]=e.get("value")+"px solid black";break;case"right":n["border-right"]=e.get("value")+"px solid black";break;case"bottom":n["border-bottom"]=e.get("value")+"px solid black"}},this),console.log(n),s.get("node").setStyles(n),e.preventDefault(),o.hide()}},{value:"Cancel",section:e.WidgetStdMod.FOOTER,action:function(e){e.preventDefault(),o.hide()}}]});o.plug(e.Plugin.Drag,{handles:[".yui3-widget-hd"]})},this),t.get("srcNode").appendChild(i),this.set("_overlay_components",[i]),t.align()}},{NAME:"border-decorator",ATTRS:{colors:{value:[],validator:function(e){return void e,!0}}}}),e.namespace("M.atto_image").custom_decorator=function(t){void t,e.M.atto_image.custom_decorator.superclass.constructor.apply(this,arguments)},e.extend(e.M.atto_image.custom_decorator,e.M.atto_image.overlay_decorator,{decorate:function(t){var n=e.M.atto_image.get("custom_decorator_button_template"),r=e.Handlebars.compile(n),i=e.Node.create(r({classes:"",title:M.util.get_string("customcsstooltip",o)}));i.on("click",function(t){void t;var n=
this,r=this.get("node"),i=e.Handlebars.compile(e.M.atto_image.get("custom_decorator_panel_template")),s=this.split_semi_colon_by_newline(r.getAttribute("style")),o=this.filter_forbidden_classes(r.getAttribute("class")),u=i({custom_css_class:this.get("disable_custom_classes")===!1,custom_styles:s+" ",custom_classes:o+" "}),a=new e.Panel({bodyContent:e.Node.create(u),headerContent:"Custom Styling and CSS",zIndex:99,width:400,centered:!0,modal:!0,render:!0,buttons:[{value:"Ok",section:e.WidgetStdMod.FOOTER,action:function(e){var t=this.get("bodyContent").item(0);t.all("div.atto-image-contenteditable").each(function(e){e.hasClass("atto-image-contenteditable-stylesheet")?n.get("node").setAttribute("style",n.get_content_editable_content(e)):e.hasClass("atto-image-contenteditable-classes")&&(n.get("node").set("className",""),n.filter_forbidden_classes_arr(n.get_content_editable_content(e)).forEach(function(e){n.get("node").addClass(e)}))},this),e.preventDefault(),a.hide()}},{value:"Cancel",section:e.WidgetStdMod.FOOTER,action:function(e){e.preventDefault(),a.hide()}}]});a.plug(e.Plugin.Drag,{handles:[".yui3-widget-hd"]}),a.getClassName("atto-image")},this),t.get("srcNode").appendChild(i),this.set("_overlay_components",[i]),t.align()},get_content_editable_content:function(e){var t=e.getHTML();return t.replace(/(<([^>]+)>)/ig,"")},split_semi_colon_by_newline:function(e,t){t=t||!0;var n=e.split(";");return t&&(n=n.map(function(e){return e.trim()})),n.join(";\n")},filter_forbidden_classes:function(e){return this.filter_forbidden_classes_arr(e).join(" ")},filter_forbidden_classes_arr:function(t){var n=t.split(" "),r=e.M.atto_image.get("image_forbidden_classes");return n.filter(function(e){var t=!1;return r.forEach(function(n){n.test(e)&&(t=!0)},this),!t},this)}},{NAME:"custom-decorator",ATTRS:{disable_custom_classes:{value:!1,validator:function(e){var t=typeof e=="boolean";return t||console.error("Given disable_custom_classes attribute is not a boolean. "),t}}}}),e.namespace("M.atto_image").vertical_align_decorator=function(t){void t,e.M.atto_image.vertical_align_decorator.superclass.constructor.apply(this,arguments)},e.extend(e.M.atto_image.vertical_align_decorator,e.M.atto_image.overlay_decorator,{decorate:function(t){var n=e.M.atto_image.get("vertical_align_decorator_button_template"),r=e.Handlebars.compile(n),i=e.Node.create(r({"class":"atto-image-text-top",title:M.util.get_string("texttoptooltip",o)})),s=e.Node.create(r({"class":"atto-image-baseline",title:M.util.get_string("textbaselinetooltip",o)})),u=e.Node.create(r({"class":"atto-image-text-bottom",title:M.util.get_string("textbottomtooltip",o)})),a=this.get("node").getStyle("vertical-align").toLowerCase();switch(a){case"text-top":this._highlight_button(i);break;case"baseline":this._highlight_button(s);break;case"text-bottom":this._highlight_button(u)}this.set("_overlay_components",[i,s,u]),i.on("click",function(e){void e,this.get("node").setStyle("vertical-align","text-top"),this._highlight_button(i),t.align()},this),s.on("click",function(e){void e,this.get("node").setStyle("vertical-align","baseline"),this._highlight_button(s),t.align()},this),u.on("click",function(e){void e,this.get("node").setStyle("vertical-align","text-bottom"),this._highlight_button(u),t.align()},this),t.get("srcNode").appendChild(i),t.get("srcNode").appendChild(s),t.get("srcNode").appendChild(u),t.align()},_highlight_button:function(e){e.addClass("atto-image-highlight"),this.get("_overlay_components").forEach(function(t){t!==e&&e.removeClass("atto-image-highlight")})},_remove_highlight_on_all_button:function(){this.get("_overlay_components").forEach(function(e){e.removeClass("atto-image-highlight")})}},{NAME:"vertical-align-decorator",ATTRS:{}}),e.M.atto_image.spacing_decorator=function(t){void t,e.M.atto_image.spacing_decorator.superclass.constructor.apply(this,arguments)},e.extend(e.M.atto_image.spacing_decorator,e.M.atto_image.overlay_decorator,{decorate:function(t){var n=e.M.atto_image.get("spacing_decorator_button_template"),r=e.Handlebars.compile(n),i=e.Node.create(r({title:M.util.get_string("spacingtooltip",o)}));i.on("click",function(t){void t;var n={left:this.get("node").getComputedStyle("margin-left"),top:this.get("node").getComputedStyle("margin-top"),right:this.get("node").getComputedStyle("margin-right"),bottom:this.get("node").getComputedStyle("margin-bottom")},r=e.Handlebars.compile(e.M.atto_image.get("spacing_decorator_panel_template")),i=e.Node.create(r({"margin-top":e.M.atto_image.parseInt10(n.top),"margin-right":e.M.atto_image.parseInt10(n.right),"margin-bottom":e.M.atto_image.parseInt10(n.bottom),"margin-left":e.M.atto_image.parseInt10(n.left)})),s=this,o=new e.Panel({bodyContent:i,headerContent:"Spacing",zIndex:99,centered:!0,modal:!0,render:!0,buttons:[{value:"Ok",section:e.WidgetStdMod.FOOTER,action:function(e){var t=this.get("bodyContent").item(0),n={};t.all("input").each(function(e){switch(e.get("name")){case"top":n["margin-top"]=e.get("value")+"px";break;case"right":n["margin-right"]=e.get("value")+"px";break;case"bottom":n["margin-bottom"]=e.get("value")+"px";break;case"left":n["margin-left"]=e.get("value")+"px";break;default:console.error("Serious error at image_spacing_decorator. Please refer this error to support/developer.")}},this),s.get("node").setStyles(n),e.preventDefault(),o.hide()}},{value:"Cancel",section:e.WidgetStdMod.FOOTER,action:function(e){e.preventDefault(),o.hide()}}]});o.plug(e.Plugin.Drag,{handles:[".yui3-widget-hd"]})},this),t.get("srcNode").appendChild(i),this.set("_overlay_components",[i]),t.align()}},{NAME:"spacing-decorator",ATTRS:{}}),e.namespace("M.atto_image").resizable=function(t){void t,e.M.atto_image.resizable.superclass.constructor.apply(this,arguments)},e.extend(e.namespace("M.atto_image").resizable,e.Base,{initializer:function(e){this.setAttrs(e),this.get("disabled")===!1&&this._enable(),this._handle_node_removal_handler(),this.publish("resizable:click",{emitFacade:!0,broadcast:2},this),this.publish("resizable:resize:start"
,{emitFacade:!0,broadcast:2},this),this.publish("resizable:resize:resize",{emitFacade:!0,broadcast:2},this),this.publish("resizable:resize:end",{emitFacade:!0,broadcast:2},this),this.publish("resizable:tween",{emitFacade:!0,broadcast:2},this),this.publish("resizable:init",{emitFacade:!0,broadcast:2,context:this},this)},destructor:function(){this.disable()},delete_all:function(){this.disable(),this.get("node")&&this.get("node").getDOMNode()&&this.get("node").remove(!0),this.destroy()},enable:function(){this.get("disabled")&&(this.set("disabled",!1),this._enable())},disable:function(){this.get("disabled")||(this._disable(),this.set("disabled",!0))},_enable:function(){var t=this._create_and_setup_preview_node(),n=this._create_and_setup_node_container();e.M.atto_image.enable_hide_until_save(this.get("node")),n.appendChild(t),this._setup_resize_overlay(),this._handle_node_container_removal_handler(),this._setup_click_event_handler()},_disable:function(){this._destroy_resize_overlay(),this.get("container")&&(this.set("disable_called",!0),this.get("container").remove(!0),this.set("container",null)),this.get("node")&&this.get("node").getDOMNode()&&e.M.atto_image.disable_hide_until_save(this.get("node"))},_create_and_setup_node_container:function(){var t=e.Handlebars.compile(e.M.atto_image.get("resize_node_container")),n=e.Node.create(t({classes:""}));this.set("container",n),n.getDOMNode().style.cssText=this.get("node").getDOMNode().style.cssText;var r=this.get("node").getComputedStyle("display")||"inline-block";r.toLowerCase()==="inline"&&(r="inline-block");var i=this.get("node").getComputedStyle("position")||"relative";if(i.toLowerCase()==="static"||i.toLowerCase()==="initial")i="relative";return n.setStyles({display:r,position:i,width:"initial",height:"initial",padding:"0px","border-width":"0px"}),this.get("node").insert(n,"before"),n},_create_and_setup_preview_node:function(){var e=this.get("node").cloneNode(!0);return this.set("preview_node",e),e.removeAttribute("id").generateID(),e.setStyles({margin:"0px",top:"0px",left:"0px"},this),e},_setup_click_event_handler:function(){this.get("container").on("click",function(e){e.stopPropagation(),this.fire("resizable:click",{item:this})},this),this.get("container").get("children").each(function(e){e.on("click",function(e){e.stopPropagation(),this.fire("resizable:click",{item:this})},this)},this)},_setup_resize_overlay:function(){var t=e.Handlebars.compile(e.M.atto_image.get("resize_overlay_node_template")),n=e.Node.create(t({classes:""})),r=this.get("preview_node").cloneNode(!0);r.removeAttribute("id").generateID(),this.set("ghost_node",r),n.appendChild(r),r.set("className",""),r.addClass("atto-image-ghost-node"),this.get("container").appendChild(n);var i=new e.Overlay({srcNode:n,width:this.get("preview_node").getDOMNode().getBoundingClientRect().width,height:this.get("preview_node").getDOMNode().getBoundingClientRect().height,visible:!0,render:!0,zIndex:1e3,align:{node:this.get("container"),points:["tl","tl"]}});this.set("resize_overlay",i),i.plug(e.Plugin.Resize,{handles:e.M.atto_image.nesw_to_trbl(this.get("handle_config"))}),i.resize.plug(e.Plugin.ResizeConstrained,{minWidth:this.get("min_width")+e.M.atto_image.get_horizontal_non_content_width(r),minHeight:this.get("min_height")+e.M.atto_image.get_vertical_non_content_width(r),maxWidth:this.get("max_width")+e.M.atto_image.get_horizontal_non_content_width(r),maxHeight:this.get("max_height")+e.M.atto_image.get_vertical_non_content_width(r),preserveRatio:this.get("preserve_ratio")},this),this._set_resize_overlay_event_handlers()},_set_resize_overlay_event_handlers:function(){this.get("resize_overlay").resize.on("resize:start",function(e){this.fire("resizable:resize:start",e),this.get("ghost_node").addClass("atto-image-ghost-node-active")},this),this.get("resize_overlay").resize.on("resize:resize",function(e){this.fire("resizable:resize:resize",e)},this),this.get("resize_overlay").resize.on("drag:end",function(t){this.get("resize_overlay").align(),this.get("ghost_node").removeClass("atto-image-ghost-node-active");var n=e.M.atto_image.parseInt10(this.get("ghost_node").getComputedStyle("width"))-e.M.atto_image.get_horizontal_non_content_width(this.get("ghost_node")),r=e.M.atto_image.parseInt10(this.get("ghost_node").getComputedStyle("height"))-e.M.atto_image.get_vertical_non_content_width(this.get("ghost_node"));this.get("node").setStyles({width:n+"px",height:r+"px"});var i=this.get("animate")!==null;if(i){var s=new e.Anim({node:this.get("preview_node"),to:{width:n+"px",height:r+"px"},duration:this.get("animate").duration,easing:this.get("animate").easing},this);s.run(),s.on("tween",function(e){this.fire("resizable:tween",e)},this)}else this.get("preview_node").setStyles({width:n+"px",height:r+"px"});this.fire("resizable:resize:end",t)},this)},_destroy_resize_overlay:function(){this.get("resize_overlay")&&(this.get("resize_overlay").destroy(!0),this.set("resize_overlay",null))},_handle_node_removal_handler:function(){var e=this,t=new MutationObserver(function(t){if(typeof e.get("node")=="undefined"||e.get("node")===null)return;t.forEach(function(t){if(t.removedNodes.length===0)return;if(typeof e.get("node")=="undefined"||e.get("node")===null)return;var n=[].indexOf.call(t.removedNodes,e.get("node").getDOMNode());if(n>=0){if(e.get("node").getDOMNode()&&t.removedNodes[n]!==e.get("node").getDOMNode())return;if(e.get("disable_called")){e.set("disable_called",!1);return}e.delete_all()}})}),n={childList:!0,subtree:!0};t.observe(e.get("node").ancestor().getDOMNode(),n)},_handle_node_container_removal_handler:function(){var e=this,t={childList:!0,subtree:!0};(new MutationObserver(function(t){if(e.get("disable_called"))return;t.forEach(function(t){if(t.removedNodes.length===0)return;if(typeof e.get("container")=="undefined"||e.get("container")===null)return;var n=[].indexOf.call(t.removedNodes,e.get("container").getDOMNode());if(n>=0){if(e.get("container").getDOMNode()&&t.removedNodes[n]!==e.get("container").getDOMNode
())return;if(e.get("disable_called")){e.set("disable_called",!1);return}e.delete_all()}}),e.get("disable_called")&&e.set("disable_called",!1)})).observe(e.get("container").ancestor().getDOMNode(),t);var n=!1;(new MutationObserver(function(t){if(e.get("disable_called"))return;t.forEach(function(t){if(t.removedNodes.length===0)return;n||(e.delete_all(),n=!0)}),e.get("disable_called")&&e.set("disable_called",!1)})).observe(e.get("container").getDOMNode(),t)}},{NAME:"resizable",ATTRS:{node:{value:null,validator:function(t){var n=t===null||t instanceof e.Node;return n||console.error("Given node to encapsulate is not of appropriate type."),n},writeOnce:!0},preview_node:{value:null,validator:function(t){var n=t===null||t instanceof e.Node;return n||console.error("Given _node_copy is not of appropriate type."),n}},ghost_node:{value:null,validator:function(t){var n=t===null||t instanceof e.Node;return n||console.error("Given _ghost_copy is not of appropriate type."),n}},container:{value:null,validator:function(t){var n=t===null||t instanceof e.Node;return n||console.error("Given container is not of valid type"),n}},disable_called:{value:!1,validator:function(e){return typeof e=="boolean"}},disabled:{value:!0,validator:function(e){var t=typeof e=="boolean";return t||console.error("disabled property is given non boolean value."),t}},resize_overlay:{value:null,validator:function(t){var n=t===null||t instanceof e.Overlay;return n||console.error("Given resize_overlay is invalid."),n}},available_handles:{value:["nw","ne","sw","se","n","s","e","w"],readOnly:!0},handle_config:{valueFn:function(){return this.get("available_handles")},setter:function(e){return typeof e=="string"&&(e=e.split(",").map(function(e){return e.trim()})),e},validator:function(e){var t=this;if(typeof e=="string"){if(e.split(",").length<1)return console.error("Please specify at least one handle."),!1;e.split(",").forEach(function(e){e=e.trim();if(t.get("available_handles").indexOf(e)===-1)return console.error("One of the given handle, "+e+"is not valid. "+'Call resizable.get("available_handles") for list of available handles.'),!1})}else{if(!(e instanceof Array))return console.error("Given handles is not an instance of Array or string."),!1;if(e.length<1)return console.error("Please specify at least one handle."),!1;e.forEach(function(e){e=e.trim();if(t.get("available_handles").indexOf(e)===-1)return console.error("One of the given handle, "+e+"is not valid. "+'Call resizable.get("available_handles") for list of available handles.'),!1})}return!0}},min_width:{value:e.M.atto_image.get("default_min_width"),setter:function(e){return this.get("resize_overlay")&&this.get("resize_overlay").resize.con.set("minWidth",e),e}},min_height:{value:e.M.atto_image.get("default_min_height"),setter:function(e){return this.get("resize_overlay")&&this.get("resize_overlay").resize.con.set("minHeight",e),e}},max_width:{value:e.M.atto_image.get("default_max_width"),setter:function(e){return this.get("resize_overlay")&&this.get("resize_overlay").resize.con.set("maxWidth",e),e}},max_height:{value:e.M.atto_image.get("default_max_height"),setter:function(e){return this.get("resize_overlay")&&this.get("resize_overlay").resize.con.set("maxHeight",e),e}},node_size:{value:null,validate:function(t){var n=t===null||typeof t.width!="undefined"&&typeof t.height!="undefined"&&e.Lang.isNumber(t.width)&&e.Lang.isNumber(t.height);return n||console.error("Given node_size is invalid. Please check the passed object."),n}},preserve_aspect_ratio:{value:!1,setter:function(e){return e=!!e,this.get("resize_overlay")&&this.get("resize_overlay").resize.con.set("preserveRatio",e),e}},animate:{valueFn:function(){return{duration:.4,easing:"easeBoth"}},validator:function(e){var t=e===null||typeof e=="object"&&e.duration&&e.easing;return t||console.error("Given animate object is invalid."),t}}}}),e.namespace("M.atto_image").resizable.is_compatible=function(){return e.M.atto_image.is_mutation_observer_supported()},e.Node.DOM_EVENTS.key.eventDef.KEY_MAP.shift=16,e.Node.DOM_EVENTS.key.eventDef.KEY_MAP.ctrl=17,e.Node.DOM_EVENTS.key.eventDef.KEY_MAP.alt=18,e.namespace("M.atto_image").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_selectedImage:null,_form:null,_rawImageDimensions:null,_resizable:null,_option_overlay_node_wrapper:null,initializer:function(){this.addButton({icon:"e/insert_edit_image",callback:this._displayDialogue,tags:"img",tagMatchRequiresAll:!1}),this.editor.delegate("dblclick",this._displayDialogue,"img",this),this.editor.delegate("click",this._handleClick,"img",this),this.editor.delegate("click",this._handleDeselect,":not(img)",this),this.editor.before(["copy","cut"],this._before_copy_cut_handler,this),e.on("resizable:click",this._resizable_click_handler,this),e.on("resizable:init",this._resizable_init_handler,this);var t=this.get("toggle_key_preserve_aspect_ratio");this.editor.delegate("key",this._toggle_key_down_preserve_aspect_ratio,"down:"+t,null,this),this.editor.delegate("key",this._toggle_key_up_preserve_aspect_ratio,"up:"+t,null,this)},_handleClick:function(t){var n=t.target;this._ensure_only_one_selected(n);var r=this._assemble_resize_config();r.node=n,r.disabled=!1,r.node_size=e.M.atto_image.get_natural_image_size(n.get("src")),r.after={init:function(){this.fire("resizable:init",{})}},this._resizable=new e.M.atto_image.resizable(r),this._resizable.get("container").before("dragstart",function(e){e.halt(!0)},this),t.halt(!0)},_handleDeselect:function(e){void e,this._resizable&&(this.get("host").setSelection([]),this._destroy_options_overlay(),this._resizable.destroy(),this._resizable=null)},_resizable_click_handler:function(e){if(e.target!==this._resizable){this._resizable&&(this.get("host").setSelection([]),this._resizable.destroy(),this._resizable=null,this._destroy_options_overlay()),this._resizable=e.target,this._resizable.enable(),this.get("host").setSelection([]);var t=this.get("host").getSelectionFromNode(this._resizable
.get("container"));this.get("host").setSelection(t),this._setup_options_overlay(),this._resizable.after("destroy",function(e){void e,this._resizable&&(this.get("host").setSelection([]),this._destroy_options_overlay(),this._resizable.destroy(),this._resizable=null)},this)}},_resizable_init_handler:function(e){this._resizable_click_handler(e)},_before_copy_cut_handler:function(t){void t;if(this._resizable){var n=this.get("host").getSelection(),r=n.map(function(t){if(this._resizable&&this.get("host").selectionContainsNode(this._resizable.get("container"))){var n=e.one(t.startContainer).compareTo(this._resizable.get("container"))||this._resizable.get("container").contains(e.one(t.startContainer))||e.one(t.startContainer).contains(this._resizable.get("container")),r=e.one(t.endContainer).compareTo(this._resizable.get("container"))||this._resizable.get("container").contains(e.one(t.endContainer))||e.one(t.endContainer).contains(this._resizable.get("container")),i=e.one(t.startContainer).get("children").size(),s=this._resizable.get("node");this._resizable.destroy(),this._resizable=null;var o=rangy.createRange();if(n&&r){var u=Math.abs(t.endOffset-t.startOffset)===1;if(u)o=this.get("host").getSelectionFromNode(s)[0];else{var a=e.one(t.startContainer).get("children").size(),f=Math.abs(a-i);o.setStart(t.startContainer,t.startOffset),o.setEnd(t.endContainer,t.endOffset-f)}}else n?(o.setStartBefore(s.getDOMNode()),o.setEnd(t.endContainer,t.endOffset)):r?(o.setStart(t.startContainer,t.startOffset),o.setEndAfter(s.getDOMNode())):(o.setStart(t.startContainer,t.startOffset),o.setEnd(t.endContainer,t.endOffset));return o}return t},this);this.get("host").setSelection(r)}},_toggle_key_down_preserve_aspect_ratio:function(e){void e,this._resizable&&this._resizable.set("preserve_aspect_ratio",!0)},_toggle_key_up_preserve_aspect_ratio:function(e){void e,this._resizable&&this._resizable.set("preserve_aspect_ratio",!1)},_assemble_resize_config:function(){var e=null;return this.get("resize_animation_enable")&&(e={duration:this.get("resize_animation_duration"),easing:this.get("resize_animation_easing")}),{handle_config:this.get("handle_config"),min_width:this.get("minmaxwidthheight").min_width,min_height:this.get("minmaxwidthheight").min_height,max_width:this.get("minmaxwidthheight").max_width,max_height:this.get("minmaxwidthheight").max_height,animate:e}},_ensure_only_one_selected:function(e){var t=this.get("host").getSelectionFromNode(e);this.get("host").setSelection(t)},_is_only_image_selected:function(e){var t=this.get("host").getSelectionFromNode(e);return this.get("host").getSelection()===t},_setup_options_overlay:function(){if(this._resizable===null)return;var t=new e.M.atto_image.overlay({align_node:this._resizable.get("container"),decorator:[new e.M.atto_image.vertical_align_decorator({node:this._resizable.get("node")}),new e.M.atto_image.float_decorator({node:this._resizable.get("node")}),new e.M.atto_image.border_decorator({node:this._resizable.get("node")}),new e.M.atto_image.spacing_decorator({node:this._resizable.get("node")}),new e.M.atto_image.custom_decorator({node:this._resizable.get("node"),disable_custom_classes:this.get("disable_custom_classes")})]},this);return t.decorate(),this._option_overlay_node_wrapper=e.Node.create(e.Handlebars.compile(e.M.atto_image.get("option_overlay_node_wrapper_template"))({classes:""})),this.get("host").editor.appendChild(this._option_overlay_node_wrapper),t.set("overlay_node_wrapper",this._option_overlay_node_wrapper),this._resizable.after(["resizable:tween","resizable:resize:end"],function(e){void e,t.align()},this),e.on("windowresize",function(e){void e,t.align()},this),t.render(),this._option_overlay_node_wrapper},_destroy_options_overlay:function(){this._option_overlay_node_wrapper&&(this._option_overlay_node_wrapper.remove(!0),this._option_overlay_node_wrapper=null)},_displayDialogue:function(){if(this._resizable){var e=this.get("host").getSelectionFromNode(this._resizable.get("node"));this.get("host").setSelection(e)}this._currentSelection=this.get("host").getSelection();if(this._currentSelection===!1)return;this._rawImageDimensions=null;var t=this.getDialogue({headerContent:M.util.get_string("imageproperties",o),width:"480px",focusAfterHide:!0,focusOnShowSelector:r.INPUTURL});t.set("bodyContent",this._getDialogueContent()).show()},_loadPreviewImage:function(e){var t=new Image,r=this;t.onerror=function(){var e=r._form.one("."+n.IMAGEPREVIEW);e.setStyles({display:"none"}),r.getDialogue().centerDialogue()},t.onload=function(){var e,t,i,o,u;r._rawImageDimensions={width:this.width,height:this.height},e=r._form.one("."+n.INPUTWIDTH),t=e.get("value"),t===""&&(e.set("value",this.width),t=""+this.width),e=r._form.one("."+n.INPUTHEIGHT),i=e.get("value"),i===""&&(e.set("value",this.height),i=""+this.height),e=r._form.one("."+n.IMAGEPREVIEW),e.setAttribute("src",this.src),e.setStyles({display:"inline"}),e=r._form.one("."+n.INPUTCONSTRAIN),t.match(s.ISPERCENT)&&i.match(s.ISPERCENT)?e.set("checked",t===i):(this.width===0&&(this.width=1),this.height===0&&(this.height=1),o=Math.round(1e3*parseInt(t,10)/this.width),u=Math.round(1e3*parseInt(i,10)/this.height),e.set("checked",o===u)),r._autoAdjustSize(r),r.getDialogue().centerDialogue()},t.src=e},_getDialogueContent:function(){var t=e.Handlebars.compile(u),r=this.get("host").canShowFilepicker("image"),s=e.Node.create(t({elementid:this.get("host").get("elementid"),CSS:n,component:o,showFilepicker:r,alignments:i}));return this._form=s,this._applyImageProperties(this._form),this._form.one("."+n.INPUTURL).on("blur",this._urlChanged,this),this._form.one("."+n.IMAGEPRESENTATION).on("change",this._updateWarning,this),this._form.one("."+n.INPUTALT).on("change",this._updateWarning,this),this._form.one("."+n.INPUTWIDTH).on("blur",this._autoAdjustSize,this),this._form.one("."+n.INPUTHEIGHT).on("blur",this._autoAdjustSize,this,!0),this._form.one("."+n.INPUTCONSTRAIN).on("change",function(e){e.target.get("checked")&&this._autoAdjustSize(
e)},this),this._form.one("."+n.INPUTURL).on("blur",this._urlChanged,this),this._form.one("."+n.INPUTSUBMIT).on("click",this._setImage,this),r&&this._form.one("."+n.IMAGEBROWSER).on("click",function(){this.get("host").showFilepicker("image",this._filepickerCallback,this)},this),s},_autoAdjustSize:function(e,t){t=t||!1;var r=this._form.one("."+n.INPUTWIDTH),i="width",o=this._form.one("."+n.INPUTHEIGHT),u="height",a=this._form.one("."+n.INPUTCONSTRAIN),f=r.get("value"),l=o.get("value"),c=this._form.one("."+n.IMAGEPREVIEW),h,p;if(!this._rawImageDimensions)return;f===""&&(f=this._rawImageDimensions[i],r.set("value",f),f=r.get("value")),c.setStyles({width:null,height:null});if(!a.get("checked"))f.match(s.ISPERCENT)?(h=parseInt(f,10),p=this._rawImageDimensions.width/100*h,c.setStyle("width",p+"px")):c.setStyle("width",f+"px"),l.match(s.ISPERCENT)?(h=parseInt(l,10),p=this._rawImageDimensions.height/100*h,c.setStyle("height",p+"px")):c.setStyle("height",l+"px");else{if(t){var d;d=r,r=o,o=d,d=i,i=u,u=d,d=f,f=l,l=d}f.match(s.ISPERCENT)?(l=f,h=parseInt(f,10),p=this._rawImageDimensions.width/100*h,c.setStyle("width",p),p=this._rawImageDimensions.height/100*h,c.setStyle("height",p)):(l=Math.round(f/this._rawImageDimensions[i]*this._rawImageDimensions[u]),t?c.setStyles({width:l,height:f}):c.setStyles({width:f,height:l})),o.set("value",l)}},_filepickerCallback:function(e){if(e.url!==""){var t=this._form.one("."+n.INPUTURL);t.set("value",e.url),this._form.one("."+n.INPUTWIDTH).set("value",""),this._form.one("."+n.INPUTHEIGHT).set("value",""),this._loadPreviewImage(e.url)}},_applyImageProperties:function(e){var t=this._getSelectedImageProperties(),r=e.one("."+n.IMAGEPREVIEW),s;if(t===!1){r.setStyle("display","none");for(s in i)i[s].isDefault===!0&&(css=i[s].value+":"+i[s].name+";",e.one("."+n.INPUTALIGNMENT).set("value",css));e.one("."+n.INPUTALIGNMENT).getDOMNode().options.remove(i.length-1);return}t.align?(e.one("."+n.INPUTALIGNMENT).set("value",t.align),e.one("."+n.INPUTALIGNMENT).getDOMNode().options.remove(i.length-1)):e.one("."+n.INPUTALIGNMENT).set("value","style:customstyle;"),t.customstyle&&e.one("."+n.INPUTCUSTOMSTYLE).set("value",t.customstyle),t.width&&e.one("."+n.INPUTWIDTH).set("value",t.width),t.height&&e.one("."+n.INPUTHEIGHT).set("value",t.height),t.alt&&e.one("."+n.INPUTALT).set("value",t.alt),t.src&&(e.one("."+n.INPUTURL).set("value",t.src),this._loadPreviewImage(t.src)),t.presentation&&e.one("."+n.IMAGEPRESENTATION).set("checked","checked"),this._autoAdjustSize()},_getSelectedImageProperties:function(){var e={src:null,alt:null,width:null,height:null,align:"",presentation:!1},t=this.get("host").getSelectedNodes(),n,r,o,u,a;t&&(t=t.filter("img"));if(t&&t.size()){image=t.item(0),this._selectedImage=image,u=image.getAttribute("style"),e.customstyle=u,u=u.replace(/ /g,""),r=image.getAttribute("width"),r.match(s.ISPERCENT)||(r=parseInt(r,10)),o=image.getAttribute("height"),o.match(s.ISPERCENT)||(o=parseInt(o,10)),r!==0&&(e.width=r),o!==0&&(e.height=o);for(n in i){a=i[n].value+":"+i[n].name+";";if(u.indexOf(a)!==-1){margin="margin:"+i[n].margin+";",margin=margin.replace(/ /g,"");if(u.indexOf(margin)!==-1){e.align=a;break}}}return e.src=image.getAttribute("src"),e.alt=image.getAttribute("alt")||"",e.presentation=image.get("role")==="presentation",e}return this._selectedImage=null,!1},_urlChanged:function(){var e=this._form.one("."+n.INPUTURL);e.get("value")!==""&&this._loadPreviewImage(e.get("value"))},_setImage:function(t){var r=this._form,o=r.one("."+n.INPUTURL).get("value"),u=r.one("."+n.INPUTALT).get("value"),f=r.one("."+n.INPUTWIDTH).get("value"),l=r.one("."+n.INPUTHEIGHT).get("value"),c=r.one("."+n.INPUTALIGNMENT).get("value"),h="",p=r.one("."+n.IMAGEPRESENTATION).get("checked"),d=r.one("."+n.INPUTCONSTRAIN).get("checked"),v,m="",g,y=[],b=this.get("host");t.preventDefault();if(this._updateWarning())return;b.focus();if(o!==""){this._selectedImage?b.setSelection(b.getSelectionFromNode(this._selectedImage)):b.setSelection(this._currentSelection);if(c==="style:customstyle;")c="",m=r.one("."+n.INPUTCUSTOMSTYLE).get("value");else for(g in i)css=i[g].value+":"+i[g].name+";",c===css&&(h=" margin: "+i[g].margin+";");d&&y.push(n.RESPONSIVE);if(!f.match(s.ISPERCENT)&&isNaN(parseInt(f,10))){r.one("."+n.INPUTWIDTH).focus();return}if(!l.match(s.ISPERCENT)&&isNaN(parseInt(l,10))){r.one("."+n.INPUTHEIGHT).focus();return}template=e.Handlebars.compile(a),v=template({url:o,alt:u,width:f,height:l,presentation:p,alignment:c,margin:h,customstyle:m,classlist:y.join(" ")}),this.get("host").insertContentAtFocusPoint(v),this.markUpdated()}this.getDialogue({focusAfterHide:null}).hide()},_updateWarning:function(){var e=this._form,t=!0,r=e.one("."+n.INPUTALT).get("value"),i=e.one("."+n.IMAGEPRESENTATION).get("checked");return r===""&&!i?(e.one("."+n.IMAGEALTWARNING).setStyle("display","block"),e.one("."+n.INPUTALT).setAttribute("aria-invalid",!0),e.one("."+n.IMAGEPRESENTATION).setAttribute("aria-invalid",!0),t=!0):(e.one("."+n.IMAGEALTWARNING).setStyle("display","none"),e.one("."+n.INPUTALT).setAttribute("aria-invalid",!1),e.one("."+n.IMAGEPRESENTATION).setAttribute("aria-invalid",!1),t=!1),this.getDialogue().centerDialogue(),t}},{NAME:"atto-image",ATTRS:{handle_config:{valueFn:function(){return["nw","ne","sw","se","n","s","e","w"]},setter:function(e){return typeof e=="string"&&(e=e.split(",").map(function(e){return e.trim()})),e}},minmaxwidthheight:{value:{min_width:e.M.atto_image.get("default_min_width"),min_height:e.M.atto_image.get("default_max_height"),max_width:e.M.atto_image.get("default_max_width"),max_height:e.M.atto_image.get("default_max_height")},setter:function(t){if(typeof t=="string")try{t=JSON.parse(t)}catch(n){return console.error("Parsing minmaxwidth to JSON throws: "+n+". "+"Contact the support or developers about the problem."),e.Attribute.INVALID_VALUE}return t},validator:function(t){return typeof t=="string"?!0:typeof t!="object"?(console.error("minmaxwidthheight attribute is given an invalid type."
),!1):(Object.keys(t).forEach(function(n){if(!e.Lang.isNumber(t[n]))return console.errror("One of the minmaxwidthheight field is not an integer.")}),!0)}},toggle_key_preserve_aspect_ratio:{value:"ctrl",validator:function(e){e=e.trim();var t=["ctrl","alt","shift"],n=t.indexOf(e)===-1;return n?(console.error("Given toggle key is invalid"),!1):!0}},disable_custom_classes:{value:!1,setter:function(e){return typeof e!="boolean"&&(e=e!=="0"),e=!!e,e}},resize_animation_enable:{value:!0,setter:function(e){return typeof e!="boolean"&&(e=e==="1"),e=!!e,e}},resize_animation_duration:{value:.4,setter:function(e){return parseFloat(e)},validator:function(t){var n=e.Lang.isNumber(parseFloat(t));return n||console.error("Given resize_animation_duration is not a number."),n}},resize_animation_easing:{value:"easeBoth",validator:function(t){var n=e.M.atto_image.get("easing_classes").indexOf(t)!==-1;return n||console.error("Given easing function is not known."),n}}}})},"@VERSION@",{requires:["moodle-editor_atto-rangy","moodle-editor_atto-plugin","resize","resize-plugin","dd-plugin","dd-constrain","graphics","transition","event-custom","event-focus","anim"]});
