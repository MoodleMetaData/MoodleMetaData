YUI.add("moodle-atto_morefontcolors-button",function(e,t){var n='<div class="open {{config.buttonClass}} atto_menu" style="min-width:{{config.innerOverlayWidth}}; background-color: #FFFFFF; border: 1px solid #CCC; padding: 5px; border-radius: 5px;"></div>',r='<div style="padding: 0px; display: table; margin: 0px; line-height: 0px;"></div>',i='<a style="width: {{width}}; height: {{height}}; background-color: {{color}}; border: 1px solid #CCC; display: inline-block; margin: 5px 5px 0px 0px;padding: 0px;"class="atto_menuentry"href="#"></a>';MenuExt=function(){MenuExt.superclass.constructor.apply(this,arguments)},e.extend(MenuExt,M.core.dialogue,{_menuHandlers:null,initializer:function(t){var r,i;this._menuHandlers=[];var s=[],o=t.rowSize,u=0;while(t.items.length>0)s.push(this._generateColorRow(t.items.splice(0,o),u)),u+=o;var a=e.Handlebars.compile(n),f=e.Node.create(a({config:t}));e.Array.each(s,function(e){f.appendChild(e)}),this.set("bodyContent",f),i=this.get("boundingBox"),i.addClass("editor_atto_controlmenu"),i.addClass("editor_atto_menu"),i.one(".moodle-dialogue-wrap").removeClass("moodle-dialogue-wrap").addClass("moodle-dialogue-content"),r=e.Node.create("<h3/>").addClass("accesshide").setHTML(this.get("headerText")),this.get("bodyContent").prepend(r),this.headerNode.hide(),this.footerNode.hide(),this._setupHandlers()},_setupHandlers:function(){var e=this.get("contentBox");this._menuHandlers.push(e.delegate("key",this._chooseMenuItem,"32, enter",".atto_menuentry",this),e.delegate("key",this._handleKeyboardEvent,"down:38,40",".dropdown-menu",this),e.on("focusoutside",this.hide,this),e.delegate("key",this.hide,"down:37,39,esc",".dropdown-menu",this))},_chooseMenuItem:function(e){e.target.simulate("click"),e.preventDefault()},hide:function(e){if(this.get("preventHideMenu")===!0)return;e&&e.preventDefault();var t=this.get("contentBox");return t.setStyle("display","none"),MenuExt.superclass.hide.call(this,arguments)},_handleKeyboardEvent:function(e){e.preventDefault();var t=e.currentTarget.all('a[role="menuitem"]'),n=!1,r=0,i=1,s=0,o=e.target.ancestor('a[role="menuitem"]',!0);while(!n&&r<t.size())t.item(r)===o?n=!0:r++;if(!n)return;e.keyCode===38&&(i=-1);do r+=i,r<0?r=t.size()-1:r>=t.size()&&(r=0),next=t.item(r),s++;while(s<t.size()&&next!==o&&next.hasAttribute("hidden"));next&&next.focus(),e.preventDefault(),e.stopImmediatePropagation()},_generateColorRow:function(t){var n=e.Handlebars.compile(i),s=e.Node.create(r);return e.Array.each(t,function(t){var r=e.Node.create(n({width:"20px",height:"20px",color:t.color}));r.on("click",t.callback,t.thisAnchor,t.color),s.appendChild(r)}),s}},{NAME:"menu-ext",ATTRS:{headerText:{value:""}}}),e.Base.modifyAttrs(MenuExt,{width:{value:"auto"},hideOn:{value:[{eventName:"clickoutside"}]},extraClasses:{value:["editor_atto_menu"]},responsive:{value:!1},visible:{value:!1},center:{value:!1},closeButton:{value:!1}}),e.namespace("M.atto_morefontcolors").MenuExt=MenuExt;var s=1,o=20,u="disabled";e.namespace("M.atto_morefontcolors").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){this.thisIsZeroIfFirstTime=0;var t=[],n=this.get("colors");thisAnchor2=this,e.Array.each(n,function(e){t.push({color:e,callbackArgs:e,thisAnchor:thisAnchor2,callback:thisAnchor2._changeStyle})});var r=this._getDesiredRowCount();this.addToolbarMenu({icon:"e/text_color",overlayWidth:"4",menuColor:"#333333",globalItemConfig:{callback:this._changeStyle},rowSize:r,items:t})},_showToolbarMenu:function(t,n){t.preventDefault();if(!this.isEnabled())return;if(t.currentTarget.ancestor("button",!0).hasAttribute(u))return;var r;this.menus[n.buttonClass]||(n.overlayWidth||(n.overlayWidth="14"),n.innerOverlayWidth||(n.innerOverlayWidth=parseInt(n.overlayWidth,10)-2+"em"),n.overlayWidth=parseInt(n.overlayWidth,10)+"em",this.menus[n.buttonClass]=new e.M.atto_morefontcolors.MenuExt(n),this.menus[n.buttonClass].get("contentBox").delegate("click",this._chooseMenuItem,".atto_menuentry a",this,n)),e.Array.each(this.get("host").openMenus,function(e){e.set("focusAfterHide",null)});var i=this.buttons[n.buttonName];i.focus(),this.get("host")._setTabFocus(i),r=this.menus[n.buttonClass],r.set("focusAfterHide",i);var s=r.get("contentBox"),o=s.getStyle("display").toLowerCase();o==="none"||o===null||typeof o=="undefined"?(s.setStyle("display","block"),r.show(),this.thisIsZeroIfFirstTime=1):this.thisIsZeroIfFirstTime===0?(s.setStyle("display","block"),r.show(),this.thisIsZeroIfFirstTime=1):(s.setStyle("display","none"),r.hide(),this.thisIsZeroIfFirstTime=1),r.align(this.buttons[n.buttonName],[e.WidgetPositionAlign.TL,e.WidgetPositionAlign.BL]),this.get("host").openMenus=[r]},_getDesiredRowCount:function(){var e=this.get("colors"),t=e.length,n=Math.ceil(Math.sqrt(t));return n<s?n=s:n>o&&(n=o),n},_changeStyle:function(e,t){this.get("host").formatSelectionInlineStyle({color:t})}},{ATTRS:{colors:{value:{}}}})},"@VERSION@",{requires:["node","moodle-core-notification-dialogue","moodle-editor_atto-menu"]});
